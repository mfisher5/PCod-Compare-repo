library(ggplot2)
library(dplyr)
#directory with bayescan plotting script (Bayescan script)
bscan_direct <- "D:/Pacific cod/DataAnalysis/PCod-Compare-repo/analyses/R"
#directory with bayescan output (both)
workingdirect <- "D:/Pacific cod/DataAnalysis/PCod-Compare-repo/analyses/outliers"
#fst file (Bayescan script)
fst_file <- "batch_8_all_Bayescan_p100_rerun_output_fst.txt"
#.sel file (Bayescan script)
sel_file <- "batch_8_all_Bayescan_p100_rerun_output.sel"
# output file (both)
outfile <- "batch_8_all_Bayescan_p100_rerun_outliers.csv"
#set false discovery rate cutoff (both)
fdr <- 0.05
#fst file edited to include stacks locus IDs (alt. function)
fst_edit <- "batch_8_all_Bayescan_p100_rerun_fst_stacksIDs.txt"
#plot title (alt. function)
plt.title = "Bayescan Outliers - East v. West (Prior100)"
po <- log10(fdr)
## set wd to output file location
setwd(workingdirect)
## read in fst file
library(readr)
mydata <- read_delim(fst_edit," ", escape_double = FALSE, trim_ws = TRUE)
## edit infile (because of weird spacing in header lines, from bayescan)
head(mydata)
## add column with log10(q val)
mydata <- mutate(mydata, log10q = log10(mydata$qval))
head(mydata)
min(mydata$log10q)
## add column to identify if loci are outliers or not
mydata <- mutate(mydata, outlier = ifelse(mydata$log10q < po, "True", "False"))
head(mydata)
## output fst file with only outlier loci
outlier_sub <- subset(mydata, outlier == "True")
dim(outlier_sub)
write.csv(outlier_sub, file=outfile, quote=FALSE,  row.names=FALSE)
## plot with ggplot
outliers <- as.factor(mydata$outlier)
base_plot <- ggplot(mydata, aes(x=log10q, y=fst, col=outliers)) +
geom_point(size=2) +
scale_x_reverse(lim=c(0.05,-2)) +
geom_vline(xintercept=po) +
labs(title=plt.title,y="Fst",x="Log10q") +
guides(color="none")
base_plot # if you get an error here about removing data points, increase limit of x axis
outliers <- as.factor(mydata$outlier)
base_plot <- ggplot(mydata, aes(x=log10q, y=fst, col=outliers)) +
geom_point(size=2) +
scale_x_reverse(lim=c(0.05,-10)) +
geom_vline(xintercept=po) +
labs(title=plt.title,y="Fst",x="Log10q") +
guides(color="none")
base_plot # if you get an error here about removing data points, increase limit of x axis
bscan_direct <- "D:/Pacific cod/DataAnalysis/PCod-Compare-repo/analyses/R"
#directory with bayescan output (both)
workingdirect <- "D:/Pacific cod/DataAnalysis/PCod-Compare-repo/analyses/outliers"
#fst file (Bayescan script)
fst_file <- "batch_8_all_byreg_Bayescan_p100_rerun_output_fst.txt"
#.sel file (Bayescan script)
sel_file <- "batch_8_all_byreg_Bayescan_p100_rerun_output.sel"
# output file (both)
outfile <- "batch_8_all_byreg_Bayescan_p100_rerun_outliers.csv"
#set false discovery rate cutoff (both)
fdr <- 0.05
#fst file edited to include stacks locus IDs (alt. function)
fst_edit <- "batch_8_all_byreg_Bayescan_p100_rerun_fst_stacksIDs.txt"
#plot title (alt. function)
plt.title = "Bayescan Outliers - East v. West (Prior100)"
setwd(bscan_direct)
## source r script with plot function
source("BAYESCAN_plot_R.r")
## set wd to output file location
setwd(workingdirect)
## produce a list of outlier loci, and a plot of fst v. log10(qvalue)
plot_bayescan(fst_file, FDR = fdr) #FDR sets cutoff
## produce a plot of posterior distribution of any parameter
mydata = read.table(sel_file, colClasses = "numeric")
parameter = "Fst1"
plot(density(mydata[[parameter]]), xlab=parameter, main=paste(parameter,"posterior distribution"))
po <- log10(fdr)
## set wd to output file location
setwd(workingdirect)
## read in fst file
library(readr)
mydata <- read_delim(fst_edit," ", escape_double = FALSE, trim_ws = TRUE)
## edit infile (because of weird spacing in header lines, from bayescan)
head(mydata)
## add column with log10(q val)
mydata <- mutate(mydata, log10q = log10(mydata$qval))
head(mydata)
min(mydata$log10q)
## add column to identify if loci are outliers or not
mydata <- mutate(mydata, outlier = ifelse(mydata$log10q < po, "True", "False"))
head(mydata)
## output fst file with only outlier loci
outlier_sub <- subset(mydata, outlier == "True")
dim(outlier_sub)
write.csv(outlier_sub, file=outfile, quote=FALSE,  row.names=FALSE)
## plot with ggplot
outliers <- as.factor(mydata$outlier)
base_plot <- ggplot(mydata, aes(x=log10q, y=fst, col=outliers)) +
geom_point(size=2) +
scale_x_reverse(lim=c(0.05,-10)) +
geom_vline(xintercept=po) +
labs(title=plt.title,y="Fst",x="Log10q") +
guides(color="none")
base_plot # if you get an error here about removing data points, increase limit of x axis
